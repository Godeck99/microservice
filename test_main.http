#!/bin/bash

word_file="denied_words.txt"
search_dirs=("../app/" "../kubernetes/")

# Check if word file exists
if [ ! -f "$word_file" ]; then
    echo "Word file not found: $word_file"
    exit 1
fi

# Check if search directories exist
for dir in "${search_dirs[@]}"; do
    if [ ! -d "$dir" ]; then
        echo "Search directory not found: $dir"
        exit 1
    fi
done

# Initialize an associative array to store results
declare -A results

# Read words from the file
while IFS= read -r word; do
    # Use grep to search for the word in files across all specified directories
    for dir in "${search_dirs[@]}"; do
        found=$(grep -r -l "$word" "$dir")
        
        # If the word is found, add it to the results
        if [ -n "$found" ]; then
            if [ -z "${results[$word]}" ]; then
                results["$word"]="$found"
            else
                results["$word"]+=$'\n'"$found"
            fi
        fi
    done
done < "$word_file"

# Check if any words were found
if [ ${#results[@]} -eq 0 ]; then
    echo "No words from $word_file were found in the specified directories"
    exit 0
else
    echo "The following denied words were found:"
    for word in "${!results[@]}"; do
        echo "Word '$word' found in:"
        echo "${results[$word]}"
        echo "---"
    done
    exit 1
fi